#labels Featured
= Introduction to Moq =

Moq is intended to be simple to use, strong typed (no magic strings!, and therefore full compiler-verified and refactoring-friendly) and minimalistic.

==Methods==

{{{
var mock = new Mock<IFoo>();
mock.Expect(foo => foo.Execute("ping")).Returns(true);


// out arguments
var outString = "ack";
// TryParse will return true, and the out argument will return "ack", lazy evaluated
mock.Expect(foo => foo.TryParse("ping", out outString)).Returns(true);


// ref arguments
var instance = new Bar();
// Only matches if the ref argument to the invocation is the same instance
mock.Expect(foo => foo.Submit(ref instance)).Returns(true);


// access invocation arguments
mock.Expect(x => x.Execute(It.IsAny<string>()))
		.Returns((string s) => s.ToLower());


// throwing when invoked
mock.Expect(foo => foo.Execute("reset")).Throws<InvalidOperationException>();
mock.Expect(foo => foo.Execute("")).Throws(new ArgumentException("command");


// lazy evaluating return value
mock.Expect(foo => foo.Count()).Returns(() => count);


// returning different values on each invocation
var mock = new Mock<IFoo>();
var calls = 0;
mock.Expect(foo => foo.Execute("ping"))
    .Returns(() => calls)
    .Callback(() => calls++);
// returns 0 on first invocation, 1 on the next, and so on
Console.WriteLine(mock.Object.Execute("ping"));

}}}

==Matching Arguments==

{{{
// any value
mock.Expect(foo => foo.Execute(It.IsAny<string>())).Returns(true);


// matching Func<int>, lazy evaluated
mock.Expect(foo => foo.Add(It.Is<int>(i => i % 2 == 0).Returns(true); 


// matching ranges
mock.Expect(foo => foo.Add(It.IsInRange<int>(0, 10, Range.Inclusive).Returns(true); 


// matching regex
mock.Expect(x => x.Execute(It.IsRegex("[a-d]+", RegexOptions.IgnoreCase))).Returns("foo");
}}}

==Properties==

{{{
mock.Expect(foo => foo.Name).Returns("bar");


// auto-mocking hierarchies
mock.Expect(foo => foo.Bar.Baz.Name).Returns("baz");


mock.ExpectSet(foo => foo.Name, "foo" /* expected value */);
}}}

==Events==
{{{
var handler = mock.CreateEventHandler<FooArgs>();
// Associate the handler with the event we'll raise
view.Object.FooSelected += handler;

// Raise the event
handler.Raise(new FooArgs { Value = "foo" });

// Causing the event to raise automatically when Submit is invoked
mock.Expect(foo => foo.Submit()).Raises(handler, new FooArgs { Value = "foo" });
}}}
===Next version===
{{{
// Raising an event on the mock
mock.Raise(m => m.FooEvent += null, new FooEventArgs(fooValue));

// Raising an event on a descendant down the hierarchy
mock.Raise(m => m.Child.First.FooEvent += null, new FooEventArgs(fooValue));

// Causing an event to raise automatically when Submit is invoked
mock.Expect(foo => foo.Submit()).Raises(f => f.Sent += null, EventArgs.Empty);
// The raised event would trigger behavior on the object under test, which 
// you would make assertions about later (how its state changed as a consequence, typically)
}}}

==Callbacks==

{{{
var mock = new Mock<IFoo>();
mock.Expect(foo => foo.Execute("ping"))
    .Returns(true)
    .Callback(() => calls++);


// access invocation arguments
mock.Expect(foo => foo.Execute(It.IsAny<string>()))
    .Returns(true)
    .Callback((string s) => calls.Add(s));


// callbacks can be specified before and after invocation
mock.Expect(foo => foo.Execute("ping"))
    .Callback(() => Console.WriteLine("Before returns"))
    .Returns(true)
    .Callback(() => Console.WriteLine("After returns"));
}}}

== Verification==

{{{
mock.Verify(foo => foo.Execute("ping"));
mock.VerifyGet(foo => foo.Name);
mock.VerifySet(foo => foo.Name, "foo");
}}}

== Advanced Features == 

{{{
// get mock from a mocked instance
IFoo foo = // get instance somehow
var fooMock = Mock.Get(foo);
fooMock.Expect(f => f.Submit()).Returns(true);


// implementing multiple interfaces in mock
var foo = new Mock<IFoo>();
var disposableFoo = foo.As<IDisposable>();
// now the IFoo also implements IDisposable :)
disposableFoo.Expect(df => df.Dispose());


// custom matchers
mock.Expect(foo => foo.Submit(IsLarge())).Throws<ArgumentException>();
...
[Matcher]
public string IsLarge() { return null; }
public bool IsLarge(string arg)
{ 
  return !String.IsNullOrEmpty(arg) && arg.Length > 100;
}


}}}


=Read more=
  * [http://weblogs.asp.net/stephenwalther/archive/2008/06/11/tdd-introduction-to-moq.aspx TDD : Introduction to Moq]
  * [http://translate.google.com.ar/translate?u=http%3A%2F%2Fwww.gmbsg.com%2Fworks%2Findex.php%3Ftitle%3DUnit_Testing_Revisited_-_Die_Unit_Test_Evolution_mit_C-Sharp_3.0&sl=de&tl=en&hl=es&ie=UTF-8 Unit Testing Revisited - The evolution unit test with C-Sharp 3.0] (Google-translated)
  * [http://www.nixusg.com/post/2008/08/10/The-Automated-Testing-Continuum-Part-3-(Moq).aspx The automated testing continuum]
  * [http://www.emadibrahim.com/2008/04/04/unit-test-linq-to-sql-in-aspnet-mvc-with-moq/ Unit Test Linq to Sql in ASP.Net MVC with Moq]
  * [http://www.bestechvideos.com/2008/06/08/dimecasts-net-introduction-to-mocking-with-moq?query=moq+screencast Introduction to Mocking with Moq (Video)]
  * [http://geekswithblogs.net/liammclennan/archive/2008/05/09/122007.aspx Comparing Moq to Rhino Mocks]
  * [http://www.hanselman.com/blog/MoqLinqLambdasAndPredicatesAppliedToMockObjects.aspx Moq: Linq, Lambdas and Predicates applied to Mock Objects]
  * [http://www.goneeded.com/javas/articles/20080324/a1811942466.html 
  * [http://weblogs.manas.com.ar/bcardiff/2008/04/improoved-argument-matchers-in-moq/ Improved argument matchers in Moq]
  * [http://www.madprops.org/blog/moq-triqs-successive-expectations/ Moq Triqs - Successive Expectations]


----
*Note*: when you need to pass the mock for consumption, you must use the `mock.Object` accessor as a consequence of a C# compiler restriction (vote to get it removed [https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=318122 at Microsoft Connect])

Head on to the [http://www.clariusconsulting.net/labs/moq/index.html API documentation], [http://code.google.com/p/moq/downloads/list download it] and have fun! Engage in the [http://groups.google.com/group/moqdisc discussion group] to give us feedback, share your experiences or wishes for vNext!